{
  "hash": "53427b8139a4e11ef8ea763cf046a47d",
  "result": {
    "markdown": "---\ntitle: 'Map coloring: the color scale styles available in the tmap package'\nauthor: Jakub Nowosad\ndate: '2019-10-17'\ncategories:\n  - vignette\n  - rstats\ntags:\n  - geocompr\n  - rspatial\n  - tmap\n  - maps\n  - viz\ndraft: false\n---\n\n\n\n\nThis vignette builds on the [making maps chapter](https://geocompr.robinlovelace.net/adv-map.html) of [the Geocomputation with R book](https://geocompr.github.io/).\nIts goal is to demonstrate all possible map styles available in the **tmap** package.\n\n## Prerequisites {-}\n\nThe examples below assume the following packages are attached:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(spData) # example datasets\nlibrary(tmap)   # map creation\nlibrary(sf)     # spatial data reprojection\n```\n:::\n\n\nThe `world` object containing a world map data from [Natural Earth](https://www.naturalearthdata.com/) and information about countries' names, regions, and subregions they belong to, areas, life expectancies, and populations.\nThis object is in geographical coordinates using the WGS84 datum, however, for mapping purposes, the Mollweide projection is a better alternative (learn more in [the modifying map projections section](https://geocompr.robinlovelace.net/reproj-geo-data.html#modifying-map-projections)).\nThe `st_tranform` function from the **sf** package allows for quick reprojection to the selected coordinate reference system (e.g., `\"+proj=moll\"` represents the Mollweide projection).\n\n\n::: {.cell}\n\n```{.r .cell-code}\nworld_moll = st_transform(world, crs = \"+proj=moll\")\n```\n:::\n\n\n# One color\n\nLet's start with the basics.\nTo create a simple world map, we need to specify the data object (`world_moll`) inside the `tm_shape()` function, and the way we want to visualize it.\nThe **tmap** package offers several visualisation possibilities for polygons, including `tm_borders()`, `tm_fill()`, and `tm_polygons()`.\nThe last one draws the filled polygons with borders, where the fill color can be specified with the `col` argument:\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntm_shape(world_moll) +\n  tm_polygons(col = \"lightblue\")\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-3-1.png){width=768}\n:::\n:::\n\n\nThe output is a map of world countries, where each country is filled with a light blue color.\n\n# Coloring of adjacent polygons\n\nThe `col` argument is very flexible, and its action depends on the value provided.\nIn the previous example, we provided a single color value resulting in a map with one color. \nTo create a map, where adjacent polygons do not get the same color, we need to provide a keyword `\"MAP_COLORS\"`.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntm_shape(world_moll) +\n  tm_polygons(col = \"MAP_COLORS\")\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-4-1.png){width=768}\n:::\n:::\n\n\nThe default color can be changed using the `palette` argument - run the `tmaptools::palette_explorer()` function to see possible palettes' names.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntm_shape(world_moll) +\n  tm_polygons(col = \"MAP_COLORS\",\n              palette = \"Pastel1\")\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-5-1.png){width=768}\n:::\n:::\n\n\n<!-- Additionally, the number of classes can be set using the `n` argument. -->\nAdditionally, in this case, it is possible to use the `minimize` argument, which triggers the internal algorithm to search for a minimal number of colors for visualization.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntm_shape(world_moll) +\n  tm_polygons(col = \"MAP_COLORS\",\n              minimize = TRUE)\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-6-1.png){width=768}\n:::\n:::\n\n\nThe new map uses five colors<!-- except for Angola (blue color)-->. \nOn a side note, in theory, no more than four colors are required to color the polygons of the map so that no two adjacent polygons have the same color (learn more about the four color map theorem on [Wikipedia](https://en.wikipedia.org/wiki/Four_color_theorem)).\n\n# Categorical maps\n\nThe third use of the `col` argument is by providing the variable (column) name.\nIn this case, the map will represent the given variable.\nBy default, **tmap** behaves differently depending on the input variable type.\nFor example, it will create a categorical map when the provided variable contains characters or factors.\nThe `tm_polygons(col = \"subregion\", style = \"cat\")` code will be run automatically in this case.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntm_shape(world_moll) +\n  tm_polygons(col = \"subregion\")+\n  tm_layout(legend.outside = TRUE) \n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-7-1.png){width=768}\n:::\n:::\n\n\n# Discrete maps\n\nDiscrete maps represents continuous numerical variables using discrete class intervals.\nThere are several ways to convert continuous variables to discrete ones implemented in **tmap**.\n\n## Pretty\n\nWhen the variable provided as the `col` argument is numeric, **tmap** will use the `\"pretty\"` style as a default.\nIn other words, it runs `tm_polygons(col = \"lifeExp\", style = \"pretty\")` invisibly to the user.\nThis style rounds breaks into whole numbers where possible and spaces them evenly.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntm_shape(world_moll) +\n  tm_polygons(col = \"lifeExp\",\n              legend.hist = TRUE) +\n  tm_layout(legend.outside = TRUE) \n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-8-1.png){width=768}\n:::\n:::\n\n\nA histogram is added using `legend.hist = TRUE` in this and several next examples to show how the selected map style relates to the distribution of values. \n\nIt is possible to indicate a preferred number of classes using the `n` argument.\nImportantly, not every `n` is possible depending on the range of the values in the data.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntm_shape(world_moll) +\n  tm_polygons(col = \"lifeExp\",\n              legend.hist = TRUE,\n              n = 4) +\n  tm_layout(legend.outside = TRUE) \n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-9-1.png){width=768}\n:::\n:::\n\n\n## Fixed\n\nThe `\"fixed\"` style allows for a manual selection of the breaks in conjunction with the `breaks` argument. \n\n\n::: {.cell}\n\n```{.r .cell-code}\ntm_shape(world_moll) +\n  tm_polygons(col = \"lifeExp\", \n              style = \"fixed\",\n              breaks = c(45, 60, 75, 90),\n              legend.hist = TRUE) +\n  tm_layout(legend.outside = TRUE) \n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-10-1.png){width=768}\n:::\n:::\n\n\nAdditionally, the default labels can be overwritten using the `labels` argument.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntm_shape(world_moll) +\n  tm_polygons(col = \"lifeExp\", \n              style = \"fixed\",\n              breaks = c(45, 60, 75, 90),\n              labels = c(\"low\", \"medium\", \"high\"),\n              legend.hist = TRUE) +\n  tm_layout(legend.outside = TRUE) \n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-11-1.png){width=768}\n:::\n:::\n\n\n## Breaks based on the standard deviation value\n\nThe `\"sd\"` style calculates a standard deviation of a given variable, and next use this value as the break width.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntm_shape(world_moll) +\n  tm_polygons(col = \"lifeExp\", \n              style = \"sd\",\n              legend.hist = TRUE) +\n  tm_layout(legend.outside = TRUE)\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-12-1.png){width=768}\n:::\n:::\n\n\n## Fisher algorithm\n\nThe `\"fisher\"` style creates groups with maximalized homogeneity.^[https://www.tandfonline.com/doi/abs/10.1080/01621459.1958.10501479] \n\n\n::: {.cell}\n\n```{.r .cell-code}\ntm_shape(world_moll) +\n  tm_polygons(col = \"lifeExp\",\n              style = \"fisher\",\n              legend.hist = TRUE) +\n  tm_layout(legend.outside = TRUE) \n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-13-1.png){width=768}\n:::\n:::\n\n\n\n## Jenks natural breaks \n\nThe `\"jenks\"` style identifies groups of similar values in the data and maximizes the differences between categories.^[https://en.wikipedia.org/wiki/Jenks_natural_breaks_optimization]\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntm_shape(world_moll) +\n  tm_polygons(col = \"lifeExp\",\n              style = \"jenks\",\n              legend.hist = TRUE) +\n  tm_layout(legend.outside = TRUE) \n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-14-1.png){width=768}\n:::\n:::\n\n\n## Hierarchical clustering\n\nIn the `\"hclust\"` style, breaks are created using hierarchical clustering.^[See the `?hclust` documentation for more details.]\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntm_shape(world_moll) +\n  tm_polygons(col = \"lifeExp\",\n              style = \"hclust\",\n              legend.hist = TRUE) +\n  tm_layout(legend.outside = TRUE) \n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-15-1.png){width=768}\n:::\n:::\n\n\n## Bagged clustering\n\nThe `\"bclust\"` style uses the `bclust` function to generate the breaks using bagged clustering.^[See the `?bclust` documentation for more details.]\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntm_shape(world_moll) +\n  tm_polygons(col = \"lifeExp\",\n              style = \"bclust\",\n              legend.hist = TRUE) +\n  tm_layout(legend.outside = TRUE) \n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-16-1.png){width=768}\n:::\n\n::: {.cell-output .cell-output-stdout}\n```\nCommittee Member: 1(1) 2(1) 3(1) 4(1) 5(1) 6(1) 7(1) 8(1) 9(1) 10(1)\nComputing Hierarchical Clustering\n```\n:::\n:::\n\n\n## k-means clustering\n\nThe `\"kmeans\"` style uses the `kmeans` function to generate the breaks.^[See the `?kmeans` documentation for more details.]\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntm_shape(world_moll) +\n  tm_polygons(col = \"lifeExp\", \n              style = \"kmeans\",\n              legend.hist = TRUE) +\n  tm_layout(legend.outside = TRUE) \n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-17-1.png){width=768}\n:::\n:::\n\n\n## Quantile breaks\n\nThe `\"quantile\"` style creates breaks with an equal number of features (polygons).\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntm_shape(world_moll) +\n  tm_polygons(col = \"lifeExp\", \n              style = \"quantile\",\n              legend.hist = TRUE) +\n  tm_layout(legend.outside = TRUE) \n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-18-1.png){width=768}\n:::\n:::\n\n\n## Equal breaks\n\nThe `\"equal\"` style divides input values into bins of equal range and is appropriate for variables with a uniform distribution.\nIt is not recommended for variables with a skewed distribution as the resulting map may end-up having little color diversity.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntm_shape(world_moll) +\n  tm_polygons(col = \"lifeExp\", \n              style = \"equal\",\n              legend.hist = TRUE) +\n  tm_layout(legend.outside = TRUE) \n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-19-1.png){width=768}\n:::\n:::\n\n\nLearn more about the implementation of discrete scales in [the **classInt** package's documentation](https://r-spatial.github.io/classInt/index.html).\n\n# Continuous maps\n\nThe **tmap** package also allows for creating continuous maps.\n\n## Continuous\n\nThe `\"cont\"` style presents a large number of colors over the continuous color field.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntm_shape(world_moll) +\n  tm_polygons(col = \"lifeExp\",\n              style = \"cont\") +\n  tm_layout(legend.outside = TRUE) \n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-20-1.png){width=768}\n:::\n:::\n\n\n## Order\n\nThe `\"order\"` style also presents a large number of colors over the continuous color field. \nHowever, this style is suited to visualize skewed distributions; notice that the values on the legend do not change linearly.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntm_shape(world_moll) +\n  tm_polygons(col = \"lifeExp\",\n              style = \"order\") +\n  tm_layout(legend.outside = TRUE) \n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-21-1.png){width=768}\n:::\n:::\n\n\n# Logarithmic scales\n\nThe default numeric style, `pretty`, is easy to understand, but it is not proper for maps of variables with skewed distributions.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntm_shape(world_moll) +\n  tm_polygons(col = \"pop\") +\n  tm_layout(legend.outside = TRUE) \n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-22-1.png){width=768}\n:::\n:::\n\n\nAnother possible style, `order` works better in this case; however, it is not easy to interpret.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntm_shape(world_moll) +\n  tm_polygons(col = \"pop\", \n              style = \"order\") +\n  tm_layout(legend.outside = TRUE) \n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-23-1.png){width=768}\n:::\n:::\n\n\nA better alternative, in this case, is to use a common logarithm (the logarithm to base 10) scale.\nThe **tmap** package gives two possibilities in this case - `\"log10_pretty\"` and `\"log10\"`.\nThe `\"log10_pretty\"` style is a common logarithmic version of the regular `pretty` style.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntm_shape(world_moll) +\n  tm_polygons(col = \"pop\", \n              style = \"log10_pretty\") +\n  tm_layout(legend.outside = TRUE) \n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-24-1.png){width=768}\n:::\n:::\n\n\nOn the other hand, the `\"log10\"` style is a version of a continuous scale.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntm_shape(world_moll) +\n  tm_polygons(col = \"pop\", \n              style = \"log10\") +\n  tm_layout(legend.outside = TRUE) \n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-25-1.png){width=768}\n:::\n:::\n\n\n# Conclusions\n\nSelecting a color scale style is not an easy task. \nIt depends on the type of input variable and its distribution, but also the intended audience.\nTherefore, it is worth to spend some time and think about your readers (e.g., would they be able to understand the logarithmic scale or should you use the manual breaks instead?) and your data (e.g., how many breaks should there be to show different subgroups?).\nNow you know different color scale styles implemented in **tmap**, so let's try using them for your own projects!\n\n",
    "supporting": [
      "index_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}